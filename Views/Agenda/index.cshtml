@{
    ViewData["Title"] = "Agenda Médica";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

<style>
    :root {
        --primary-color: #4e73df;
        --secondary-color: #f8f9fc;
        --accent-color: #2e59d9;
        --text-color: #5a5c69;
    }

    .agenda-container {
        max-width: 1400px;
        margin: 30px auto;
        padding: 20px;
    }

    .header-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e3e6f0;
    }

    .header-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--text-color);
    }

    .calendar-nav {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .calendar-nav-btn {
        border-radius: 8px;
        padding: 8px 15px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .current-period {
        font-weight: 600;
        min-width: 200px;
        text-align: center;
    }

    .calendar-card {
        border-radius: 12px;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        margin-bottom: 25px;
    }

    .calendar-header {
        background-color: var(--primary-color);
        color: white;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        padding: 15px 20px;
    }

    .calendar-body {
        padding: 0;
    }

    .fc {
        font-family: inherit;
    }

    .fc-toolbar-title {
        font-size: 1.25rem;
        font-weight: 600;
    }

    .fc-col-header-cell-cushion {
        color: var(--text-color);
        font-weight: 600;
    }

    .agenda-table {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
    }

        .agenda-table thead {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            color: white;
        }

        .agenda-table th {
            padding: 15px;
            font-weight: 500;
            text-align: center;
            vertical-align: middle;
        }

        .agenda-table td {
            padding: 12px;
            vertical-align: middle;
            border: 1px solid #e3e6f0;
            height: 60px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

            .agenda-table td:hover {
                background-color: rgba(78, 115, 223, 0.05);
            }

    .time-slot {
        font-weight: 600;
        color: var(--text-color);
        background-color: var(--secondary-color);
    }

    .appointment-badge {
        display: block;
        border-radius: 6px;
        padding: 5px 8px;
        font-size: 0.85rem;
        margin-bottom: 3px;
        color: white;
        text-align: left;
    }

    .badge-primary {
        background-color: var(--primary-color);
    }

    .badge-success {
        background-color: #1cc88a;
    }

    .badge-warning {
        background-color: #f6c23e;
        color: #000;
    }

    .badge-danger {
        background-color: #e74a3b;
    }

    .doctor-name {
        font-weight: 600;
        color: var(--primary-color);
    }

    .no-appointment {
        color: #b7b9cc;
        font-style: italic;
        font-size: 0.9rem;
    }


    {
        padding: 15px;
    }

    .agenda-table {
        font-size: 0.9rem;
    }

        .agenda-table th,
        .agenda-table td {
            padding: 8px;
        }

    }
</style>

<div class="agenda-container">
    <div class="header-section">
        <h1 class="header-title">
            <i class="fas fa-calendar-alt me-2"></i>Agenda Médica
        </h1>
        <div class="calendar-nav">
            <button class="btn btn-outline-secondary calendar-nav-btn" id="prev-period">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="btn btn-outline-primary calendar-nav-btn" id="today-btn">Hoje</button>
            <div class="current-period" id="current-period">Junho 2023</div>
            <button class="btn btn-outline-secondary calendar-nav-btn" id="next-period">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- Mini Calendário -->
    <div class="calendar-card">
        <div class="calendar-header">
            <h5 class="mb-0"><i class="fas fa-calendar-day me-2"></i>Selecione o Dia</h5>
        </div>
        <div class="calendar-body">
            <div id="mini-calendar"></div>
        </div>
    </div>

    <!-- Agenda Diária -->
    <div class="card">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table agenda-table">
                    <thead>
                        <tr>
                            <th style="width: 10%;">Horário</th>
                            <th>
                                <span class="doctor-name">Dr. João Silva</span><br>
                                <small class="text-white">Cardiologia</small>
                            </th>
                            <th>
                                <span class="doctor-name">Dra. Maria Oliveira</span><br>
                                <small class="text-white">Pediatria</small>
                            </th>
                            <th>
                                <span class="doctor-name">Dr. Carlos Souza</span><br>
                                <small class="text-white">Ortopedia</small>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int hour = 8; hour <= 17; hour++)
                        {
                            <tr>
                                <td class="time-slot"><strong>@hour:00</strong></td>
                                <td ondblclick="window.location.href='@Url.Action("DetalharAtendimento", "Agenda")'">
                                    @if (hour == 9)
                                    {
                                        <span class="appointment-badge badge-primary">
                                            <i class="fas fa-user me-1"></i>Fulano de Tal
                                        </span>
                                        <small>Consulta de rotina</small>
                                    }
                                    else if (hour == 14)
                                    {
                                        <span class="appointment-badge badge-warning">
                                            <i class="fas fa-user me-1"></i>Ciclano Silva
                                        </span>
                                        <small>Retorno</small>
                                    }
                                    else
                                    {
                                        <span class="no-appointment">Livre</span>
                                    }
                                </td>
                                <td ondblclick="window.location.href='@Url.Action("DetalharAtendimento", "Agenda")'">
                                    @if (hour == 10)
                                    {
                                        <span class="appointment-badge badge-success">
                                            <i class="fas fa-child me-1"></i>Joãozinho
                                        </span>
                                        <small>Vacinação</small>
                                    }
                                    else if (hour == 16)
                                    {
                                        <span class="appointment-badge badge-danger">
                                            <i class="fas fa-child me-1"></i>Mariazinha
                                        </span>
                                        <small>Urgência</small>
                                    }
                                    else
                                    {
                                        <span class="no-appointment">Livre</span>
                                    }
                                </td>
                                <td ondblclick="window.location.href='@Url.Action("DetalharAtendimento", "Agenda")'">
                                    @if (hour == 11)
                                    {
                                        <span class="appointment-badge badge-primary">
                                            <i class="fas fa-user me-1"></i>Beltrano Costa
                                        </span>
                                        <small>Pós-operatório</small>
                                    }
                                    else
                                    {
                                        <span class="no-appointment">Livre</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/pt-br.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Configuração do mini calendário
            const miniCalendarEl = document.getElementById('mini-calendar');
            const miniCalendar = new FullCalendar.Calendar(miniCalendarEl, {
                initialView: 'dayGridMonth',
                locale: 'pt-br',
                headerToolbar: false,
                height: 'auto',
                fixedWeekCount: false,
                dayMaxEvents: true,
                dateClick: function(info) {
                    // Atualiza a data selecionada
                    updateSelectedDate(info.date);
                },
                datesSet: function(dateInfo) {
                    // Atualiza o período exibido
                    document.getElementById('current-period').textContent =
                        new Intl.DateTimeFormat('pt-BR', { month: 'long', year: 'numeric' }).format(dateInfo.start);
                }
            });
            miniCalendar.render();

            // Navegação do calendário
            document.getElementById('prev-period').addEventListener('click', function() {
                miniCalendar.prev();
            });

            document.getElementById('next-period').addEventListener('click', function() {
                miniCalendar.next();
            });

            document.getElementById('today-btn').addEventListener('click', function() {
                miniCalendar.today();
                updateSelectedDate(new Date());
            });

            // Atualiza a data selecionada
            function updateSelectedDate(date) {
                // Aqui você pode adicionar lógica para filtrar a agenda pela data selecionada
                console.log('Data selecionada:', date);
                // Exemplo: window.location.href = '@Url.Action("Index")?data=' + date.toISOString();
            }

            // Inicializa com a data atual
            updateSelectedDate(new Date());
        });
    </script>
}